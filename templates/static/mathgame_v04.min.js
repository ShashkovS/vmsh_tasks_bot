"use strict";const t=3,x=5,e=3,n=10,o=10,l=!1,s="\nx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\nx\t1\t1\t1\t1\t2\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t1\to\to\to\to\to\to\to\to\to\to\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t7\t7\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\nx\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t3\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\to\to\t1\t1\t1\t1\t1\tx\t1\tx\t1\t1\t1\tx\t1\t1\tx\tx\tx\tx\tx\t1\tx\t1\t7\t1\t1\t1\tx\nx\t1\t1\t1\tx\tx\tx\t1\t1\t1\t1\t3\t4\t3\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\tx\t1\tx\t1\t1\t1\tx\t1\t1\tx\t1\t1\t9\t1\t1\tx\t1\t7\t1\t1\t1\tx\nx\t1\t1\tx\t1\tx\t10\tx\t1\t1\t1\t1\tx\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\tx\t1\tx\t1\t1\t1\tx\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t7\t1\t1\t1\tx\nx\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\tx\tx\t1\t1\t1\tx\t5\t5\t5\t5\t5\tx\t5\t5\t5\t5\t5\t5\tx\t4\tx\tx\tx\tx\tx\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t7\t2\t2\t2\tx\nx\t1\t1\t1\tx\tx\tx\t1\t1\t1\tx\t1\tx\t1\tx\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\tx\t1\tx\t1\t10\t.\tx\t1\t1\tx\t1\t2\t1\t2\t1\tx\t1\t7\t1\t1\t1\tx\nx\t1\t1\tx\t9\tx\t1\tx\t1\t1\t1\t1\tx\t1\t1\t1\t1\tx\t1\t5\t5\t5\t5\tx\t1\t5\t5\t5\t5\t5\tx\t1\tx\t1\t1\t1\tx\t1\t1\tx\t1\t1\t2\t1\t1\tx\t1\t7\t2\t2\t2\tx\nx\t1\tx\t1\t1\tx\t1\t1\tx\t1\t1\tx\tx\tx\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\tx\t1\tx\t1\t1\t1\tx\t1\t1\tx\t1\t2\t1\t2\t1\t8\t1\t7\t1\t1\t1\tx\nx\t1\t1\t1\tx\tx\tx\t1\t1\t1\tx\t1\tx\t8\tx\t1\t1\tx\t1\t2\t1\t2\t1\tx\tx\tx\tx\t1\t1\t1\tx\t1\tx\t1\t1\t1\tx\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t7\t2\t2\t2\tx\nx\t1\t1\t1\t1\t6\t1\t1\t1\tx\t1\t1\tx\t1\t1\tx\t1\tx\t1\t2\t1\t2\t1\t1\t8\t1\tx\tx\tx\t5\tx\t1\t1\t1\t1\t7\t7\t7\t1\t1\t1\t1\t1\t1\t1\t1\t1\t7\t1\t1\t1\tx\nx\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\tx\tx\tx\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\tx\nx\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\t6\t6\t6\t1\t1\t1\t5\t1\t1\t1\t1\tx\tx\tx\tx\tx\t1\t1\t1\t3\t1\t1\t1\t1\tx\tx\tx\t1\t1\t1\t3\t1\t1\t1\t1\tx\tx\tx\t1\t1\tx\nx\tx\t5\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t5\tx\tx\t7\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\tx\t1\tx\t1\tx\t1\t1\tx\t1\t1\t1\tx\t1\tx\t1\tx\t1\tx\nx\t1\t1\t1\tx\t1\t1\t1\t1\t5\t1\t1\t1\t4\t1\t1\t1\t5\t1\t1\t1\t1\tx\t7\t7\t1\t1\t1\t1\tx\tx\tx\t1\t1\t1\t1\tx\t1\t1\t1\tx\tx\tx\t1\t1\t1\t1\tx\t1\t1\t1\tx\nx\t1\t7\t1\tx\t1\t1\t2\t1\t3\t1\t4\t1\t2\t1\t4\t1\t3\t1\t1\t1\t7\tx\t7\t7\t7\t1\t1\tx\t1\tx\t1\tx\t1\t1\t1\t3\t1\t1\tx\t1\tx\t1\tx\t1\t1\t1\t3\t1\t1\t1\tx\nx\t1\t1\t1\tx\t10\t1\t4\t1\t1\t1\t6\t1\t1\t1\t5\t1\t1\t1\t1\t7\t7\t7\t7\t7\t7\t7\t1\t1\t1\tx\t1\t1\t1\t1\t1\t3\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t3\t1\t1\t1\tx\nx\tx\t5\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t7\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t5\tx\tx\nx\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t3\t1\t1\t7\t1\t1\t3\t1\t1\t1\t1\t7\t7\t7\t1\t1\t1\t1\t1\t1\t7\t1\t1\t1\t1\t1\t1\t1\t1\t1\t2\t1\t1\t1\t1\t7\t1\t1\t1\t1\tx\nx\t1\t1\tx\tx\tx\t1\t1\t1\t1\t1\t5\t1\t1\t6\t1\t1\t5\t1\t1\t1\t1\t1\t7\t1\t1\t1\t1\t1\t1\t1\t6\t1\t1\t1\t1\t2\t1\t1\t1\t2\t2\t2\t1\t1\t1\t6\t1\t1\t2\t1\tx\nx\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t7\t1\t1\t5\t1\t1\t7\t1\t1\t2\t1\t2\t1\t1\t1\t1\t1\t1\t1\t1\t5\t1\t1\t1\t2\t2\t2\t1\t1\t1\t2\t1\t1\t1\t1\t5\t1\t2\t2\t2\tx\nx\t2\t2\t2\tx\t1\t2\t2\t2\t1\t1\tx\t1\t1\t4\t1\t1\tx\t1\t1\t1\t2\t1\t1\t1\t1\t1\t1\t1\t1\t1\t4\t1\t1\t1\t1\t2\t1\t1\t1\t1\t1\t1\t1\t1\t1\t4\t1\t1\t2\t1\tx\nx\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t10\tx\t1\t3\t1\tx\t9\tx\t1\t2\t1\t2\t1\t1\t1\t1\t1\t1\t1\t1\t3\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t3\t1\t1\t1\t1\tx\nx\t2\t2\t2\tx\t1\t1\t1\t1\tx\t1\t1\t1\tx\t1\tx\t1\t1\t1\tx\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t2\t1\t1\tx\t1\t1\t1\tx\tx\tx\tx\tx\t1\tx\t1\t2\t1\tx\t1\t1\tx\nx\t1\t1\t1\tx\t7\t5\t3\t1\tx\t1\t1\t1\t1\tx\t1\t1\t1\t1\tx\t1\t1\t1\tx\tx\t1\t1\t1\tx\tx\t1\t1\t1\tx\t1\tx\t1\t1\t1\t1\tx\t1\t1\t1\tx\t1\t1\t1\tx\t1\t1\tx\nx\t2\t2\t2\tx\t1\t1\t1\t1\tx\t1\t1\t1\t2\t1\t2\t1\t1\t1\tx\t1\t1\t1\tx\t1\tx\t1\tx\t1\tx\t1\t1\tx\t1\t8\t1\tx\t1\t1\t1\tx\t1\t1\t1\tx\t1\t1\t1\tx\t1\t1\tx\nx\t1\t1\t1\tx\t1\t1\t2\t1\tx\t1\t1\t1\t1\t2\t1\t1\t1\t1\tx\t1\t2\t1\tx\t1\t1\tx\t1\t1\tx\t1\t1\tx\t1\t1\t1\tx\t1\t2\t1\tx\t1\t1\t1\tx\tx\tx\tx\tx\t1\t1\tx\nx\t1\t1\t1\tx\t1\t1\t3\t1\t1\tx\t1\t1\t2\t1\t2\t1\t1\tx\t1\t1\t3\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\tx\tx\t6\tx\tx\t1\t3\t1\tx\t1\t1\t1\tx\t1\t8\t1\tx\t1\t1\tx\nx\t1\t1\tx\tx\tx\t1\t4\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t4\t1\tx\t1\t2\t1\t2\t1\tx\t1\t1\tx\t1\t1\t1\tx\t1\t4\t1\tx\t1\t1\t1\tx\t1\t1\t1\tx\t1\t1\tx\nx\t1\t1\t1\t1\t1\t1\t5\t1\t1\t1\t1\tx\t1\t1\t1\tx\t1\t1\t1\t1\t5\t1\t1\t1\t1\t2\t1\t1\t4\t4\t4\t4\t1\t1\t1\t1\t1\t5\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t1\tx\nx\t7\t7\t7\t1\t1\t1\t6\t1\t1\t1\t1\t1\tx\t1\tx\t1\t1\t1\t1\t1\t6\t1\t1\t1\t2\t1\t2\t1\t4\t4\t4\t4\t1\t1\t1\t1\t1\t6\t1\t1\t1\t6\t6\t6\t1\t1\t1\t7\t7\t7\tx\nx\t7\t7\t7\t1\t1\t1\t7\t1\t1\t1\t1\t1\t6\t6\t6\t1\t1\t1\t1\t1\t7\t1\t1\t1\t1\t1\t1\t1\t4\t4\t4\t4\t1\t1\t1\t1\t1\t7\t1\t1\t1\t1\t6\t1\t1\t1\t1\t7\t7\t7\tx\nx\tx\t7\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t5\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t7\tx\tx\nx\t7\t7\t7\t2\t2\t2\t1\t1\t1\t6\t1\t1\t1\t3\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t7\t7\t7\tx\nx\t7\t7\t7\t2\t2\t2\t1\t1\t1\t6\t1\t1\t2\t1\t2\t1\t1\t6\t1\t1\t1\t1\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\tx\tx\tx\t1\t1\t1\t1\tx\t1\t7\t7\t7\tx\nx\t1\t1\t1\t1\tx\t1\t1\t1\t1\tx\t1\t1\tx\t1\t1\tx\t1\tx\t1\tx\t1\tx\t1\tx\t1\t1\tx\t1\t1\t1\t1\t1\tx\tx\tx\t1\t1\tx\t1\tx\t1\tx\t1\t1\tx\tx\tx\t1\t1\t1\tx\nx\t2\t2\t2\tx\t1\tx\t1\t1\tx\tx\t1\tx\t1\tx\t1\tx\t1\tx\t1\tx\t1\tx\t1\tx\t1\tx\t1\tx\t1\t1\t1\tx\t1\tx\t1\tx\t1\t1\t1\tx\t1\t1\t1\tx\t1\tx\t10\tx\t1\t1\tx\nx\t2\t2\t2\tx\t1\t1\t1\tx\t1\tx\t1\tx\t1\tx\t1\t1\tx\tx\tx\t1\t1\tx\tx\tx\t1\tx\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t5\t5\t5\t1\t1\t1\t1\tx\t1\t1\t1\t1\tx\nx\t1\t1\t1\tx\t1\tx\t2\tx\t1\tx\t2\tx\t1\tx\t2\tx\t1\tx\t1\tx\t2\tx\t1\tx\t2\tx\t1\tx\t1\t1\t1\t1\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\nx\t1\t1\t1\t1\tx\t1\t1\tx\t1\tx\t1\t1\tx\t1\t1\tx\t1\tx\t1\tx\t1\tx\t1\tx\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\nx\t1\t7\t1\t1\t6\t1\t1\t1\t3\t1\t1\t1\t6\t1\t1\t1\t1\t3\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t1\t7\t1\tx\t1\t1\tx\t1\t1\tx\tx\tx\tx\tx\t1\tx\tx\tx\tx\tx\t1\tx\nx\t7\t7\t7\t1\t6\t1\t1\t2\t1\t2\t1\t1\t6\t1\t1\t1\t2\t1\t2\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t7\t7\t7\tx\t1\tx\tx\t1\t1\t7\t10\t7\t1\tx\t1\tx\t1\t1\t1\tx\t1\tx\nx\tx\t7\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t5\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t7\tx\tx\t1\t1\tx\t1\t1\t7\t7\t7\tx\tx\t1\tx\t1\t1\t1\tx\t1\tx\nx\t7\t7\t7\t1\t1\t6\t1\t1\t1\t1\t1\t1\t1\t6\t6\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t7\t7\t7\tx\t1\t1\tx\t1\t1\t1\t1\tx\tx\t1\t1\tx\tx\tx\tx\tx\t1\tx\nx\t1\t7\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t1\t6\t6\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t7\t1\tx\t1\t1\tx\t1\t1\t1\tx\tx\t1\t1\t7\t8\t7\t1\tx\tx\t1\tx\nx\t1\tx\t1\t1\t1\tx\t1\t1\tx\tx\t1\t1\t1\tx\tx\t1\t1\tx\tx\tx\t1\tx\t1\t1\tx\t1\t1\t2\t2\t2\t2\t2\tx\t1\t1\tx\t1\t1\t1\tx\t1\t1\t1\t1\t7\t1\tx\tx\t1\t1\tx\nx\t1\tx\tx\t1\tx\tx\t1\tx\t1\t1\tx\t1\tx\t6\t8\tx\t1\tx\t1\t1\t1\tx\t1\t1\tx\t1\t1\t2\t3\t3\t3\t3\tx\t1\t1\tx\t9\t1\t1\tx\t1\t1\t1\t1\t1\tx\tx\t1\t1\t1\tx\nx\t1\tx\t1\tx\t1\tx\t1\tx\t1\t1\tx\t1\t1\t1\tx\t1\t1\tx\t1\t1\t1\tx\t1\t1\tx\t1\t1\t2\t3\t4\t4\t4\tx\t1\tx\tx\tx\t1\t1\tx\t1\t1\t1\t1\tx\tx\t1\t1\t1\t1\tx\nx\t1\tx\t1\t8\t1\tx\t1\tx\t1\t1\tx\t1\tx\t1\t1\tx\t1\tx\t1\t1\t1\t1\t1\t1\tx\t1\t1\t2\t3\t4\t5\t5\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\nx\t1\tx\t1\t1\t1\tx\t1\t1\tx\tx\t1\t1\t1\tx\tx\t1\t1\tx\t1\t1\t1\tx\t1\t1\t5\t1\t1\t2\t3\t4\t5\t6\tx\t7\t7\t7\t7\t7\t7\t7\t7\t7\t7\t7\t7\t7\t7\t7\t7\t1\tx\nx\t1\t3\t3\t3\t3\t3\t1\t1\t6\t6\t1\t1\t1\t1\t1\t1\t1\t6\t1\t1\t1\t6\t1\t1\tx\t1\t1\t2\t3\t4\t5\t6\t7\t6\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\nx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\n",c=[],a={$game:void 0,$header:void 0,$gameTable:void 0,$modal:void 0,$popup:void 0,$popupText:void 0,$popupButton1:void 0,$popupButton2:void 0,map:void 0,width:void 0,height:void 0,chests:{},opened:[],scores:{},flags:{},myFlag:void 0};function i(t,x,e,n,o){const l=parseFloat(getComputedStyle(document.documentElement).fontSize);a.$modal.style.top=`${window.scrollY+3*l}px`,a.$modal.style.left=`${a.$gameTable.offsetLeft+window.scrollX}px`,a.$modal.style.width=`${Math.min(window.innerWidth,1e3)}px`,a.$modal.style.height="calc(100% - 3rem)",a.$modal.style.transform="none",a.$modal.style.margin="auto",a.$popupText.innerHTML=x,a.$popupButton1.innerText=e,a.$popupButton1.title=n,a.$popupButton1.onclick=o,a.$popupButton1.focus(),a.$popup.style.display="block",a.$popup.style.textAlign="left",a.$popupButton2.style.display="none"}function d(t,x,e,n,o,l,s,c){const i=parseFloat(getComputedStyle(document.documentElement).fontSize),d=t.offsetLeft+t.offsetWidth/2-document.body.scrollLeft,p=t.offsetTop+t.offsetHeight/2-document.body.scrollTop,r=15*i/2,u=9*i/2;let m=p-u-3*i/2;m<u&&(m=p+u+3*i/2),m+=3*i,a.$modal.style.top=`${m}px`,a.$modal.style.left=`${Math.min(Math.max(d,r),window.scrollX+window.innerWidth-r)}px`,a.$modal.style.width="15rem",a.$modal.style.height="9rem",a.$modal.style.transform="translate(-50%, -50%)",a.$modal.style.margin="0",a.$popup.style.textAlign="center",a.$popupText.innerHTML=x,a.$popupButton1.innerText=e,a.$popupButton1.title=n,a.$popupButton1.onclick=o,a.$popupButton1.focus(),void 0===l?a.$popupButton2.style.display="none":(a.$popupButton2.style.display="inline-block",a.$popupButton2.innerText=l,a.$popupButton2.onclick=c,a.$popupButton2.title=s),a.$popup.style.display="block"}function p(){document.getElementById("popup").style.display="none"}function r(t){const x=t.trim().split("\n").map((t=>t.trim().split("\t").map((t=>parseInt(t)||t)))),e=x[0].length,n=x.length,o={};for(const t of c){const{x:x,y:n,amount:l,html:s,bonus:c}=t;o[n*e+x]={amount:l,html:s,bonus:c,isOpened:!1}}return{map:x,width:e,height:n,chests:o}}async function u(t="",x={}){return(await fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(x)})).json()}function m(t){t.className="so",a.opened.push(t.cellID),M(),k()}function h(t,x){u("/game/buy",{x:t.coln,y:t.rown,amount:x}).then((()=>()=>m(t))).catch((x=>{console.log(x),M(),k(),t.style.border="3px solid #f00"}))}function f(t){u("/game/flag",{x:t.coln,y:t.rown}).then((()=>{}))}function g(t){u("/game/chest",{x:t.coln,y:t.rown,bonus:t.chest.bonus}).then((()=>{})).catch((x=>{console.log(x),M(),k(),t.style.border="3px solid #f00"}))}function $(t){a.opened.push(...t.opened.map((([t,x])=>x*a.width+t))),a.scores={};for(const x of t.events)x>0?a.scores[x]=1+(0|a.scores[x]):F(-x);a.flags={},t.flags.forEach((([t,x])=>{const e=x*a.width+t;a.flags[e]=1+(0|a.flags[e])})),t.chests.forEach((([t,x])=>{if(!(t<0||x<0))try{a.$cells[x][t].chest.isOpened=!0}catch(t){console.log(t)}})),a.myFlag=t.myFlag&&2===t.myFlag.length&&t.myFlag.y*a.width+t.myFlag.x}async function y(t){return new Promise((x=>setTimeout(x,t)))}async function w(t){t.forEach((t=>t.tss=new Date(t.ts).getTime())),a.$header.innerHTML="<div></div>";let x,e=new URL(window.location).searchParams.get("ms"),n=!1;const o=1e3*new URL(window.location).searchParams.get("dur")||2e4;null==e?e=Math.max(4,1e3/t.length):"0"===e&&(n=!0,x=t[t.length-1].tss-t[0].tss);let l=t[0].tss;for(let s=0;s<t.length;s++){let c=0;if(n){const e=(t[s].tss-l)/x*o;e>4&&(c=e,l=t[s].tss)}else c=+e;const i=t[s].x,d=t[s].y*a.width+i;a.opened.push(d),c>=1&&(await y(c),M(),k())}M(),k(),a.$header.innerHTML="<div>Завершено</div>"}function b(){a.$header.innerHTML="<div><p><span>...⚡</span> — загружаем информацию...</p></div>";const t=parseInt(new URL(window.location).searchParams.get("command_id"));t>0?u(`/game/timeline/${t}`,{}).then((t=>{w(t)})):u("/game/me",{}).then((t=>{$(t),M(),k()}))}function v(t,x){t.textContent="...",t.onclick=null;const e=F(x);k(),p(),console.log(`Пытаемся открыть ячейку ${t.coln} ${t.rown} за ${x}`),e&&h(t,x)}function I(t){a.myFlag&&(a.flags[a.myFlag]=Math.max(0,(0|a.flags[a.myFlag])-1)),a.myFlag=t.cellID,a.flags[a.myFlag]=1+(0|a.flags[a.myFlag]),M(),p(),f(t)}function B(t){t.classList.remove("selected"),p()}function T(t){t.classList.remove("selected"),p()}function L(t){const x=t.target,{rown:e,coln:n}=x,o=e-1>=0&&"o"===a.$cells[e-1][n].textContent,l=e+1<a.height&&"o"===a.$cells[e+1][n].textContent,s=n-1>=0&&"o"===a.$cells[e][n-1].textContent,c=n+1<a.width&&"o"===a.$cells[e][n+1].textContent;if(o||l||s||c){x.classList.add("selected");const t=+x.textContent;void 0===C(t)?d(x,"Не хватает ⚡<br>Решите задачку!","Буду решать!","Закрыть окно",(()=>T(x))):d(x,`Изучить клетку<br>за ${x.textContent}⚡?`,"✅ Да!","Да, изучить клетку!",(()=>v(x,t)),"❌ Нет","Нет, вернуться назад",(()=>B(x)))}else x.classList.add("selected"),d(x,"Поставить флаг <br>для всех в ячейку?","🚩 Да!","Да, поставить флаг!",(()=>I(x)),"Нет","Нет, вернуться назад",(()=>B(x)))}function k(){a.$header.innerHTML=Object.entries(a.scores).map((([t,x])=>x>0?`<div><p><span>${t}⚡</span> × ${x} </p></div>`:"")).join(""),0===a.$header.innerHTML.length&&(a.$header.innerHTML="<div><p><span>0⚡</span> — чтобы получить энергию, нужно решить задачу </p></div>")}function C(t){for(const[x,e]of Object.entries(a.scores))if(e>0&&x>=t)return x}function S(t){const x=t.target;i(x,x.chest.html,"Круто!","Закрыть окно",(()=>T(x)))}function E(t){const x=t.target;x.chest.isOpened=!0,x.className="openedChest",x.onclick=x.ondblclick=S,a.scores[x.chest.bonus]=1+(0|a.scores[x.chest.bonus]),g(x),S(t)}function F(t){for(const[x,e]of Object.entries(a.scores))if(e>0&&x>=t){a.scores[x]-=1;const e=x-t;return e>0&&(a.scores[e]=1+(0|a.scores[e])),!0}return!1}function M(){for(const t of a.opened){const x=Math.trunc(t/a.width),e=t%a.width;"x"!==a.map[x][e]&&(a.map[x][e]="o")}const t=new Map;let x=new Set;for(let e=0;e<a.map.length;e+=1)for(let n=0;n<a.map[0].length;n+=1)if("o"===a.map[e][n]){const o=e*a.width+n;t.set(o,0),x.add(o)}let e=0;for(;x.size>0&&e<10;){let n=new Set;for(const e of x){const x=Math.trunc(e/a.width),o=e%a.width;if("x"!==a.map[x][o]&&0!==x&&0!==o&&o!==a.width-1&&x!==a.height-1)for(const x of[-1,1,-a.width-1,-a.width,1-a.width,+a.width-1,+a.width,+a.width+1]){const o=e+x;void 0===t.get(o)&&(t.set(o,t.get(e)+1),n.add(o))}}x=n,e+=1}for(let x=0;x<a.map.length;x+=1){const e=a.map[x];for(let n=0;n<e.length;n+=1){const o=e[n],l=a.$cells[x][n],s=t.get(l.cellID),c=0===x||0===n||n===a.width-1||x===a.height-1;s<10||c?(l.textContent=o,l.className=`s${o}`,l.onclick=l.ondblclick=+o?L:null,l.style.opacity=!c&&10-s<=10?(10-s)/10:1,l.chest&&(l.chest.isOpened?(l.classList.add("openedChest"),l.onclick=l.ondblclick=S):(l.classList.add("closedChest"),+o||(l.onclick=l.ondblclick=E)),l.style.opacity=1)):(l.textContent="",l.className="fog",l.onclick=l.ondblclick=null);const i=[];for(let t=0;t<(0|a.flags[l.cellID]);t++){const x=(.71*t%1.5).toFixed(2),e=(-.6-.61*t%1.8).toFixed(2);i.push(`<div class="flag" style="top: ${e}rem; left: ${x}rem; "></div>`)}l.innerHTML=l.textContent+i.join("")}}k()}function O(){a.$cells=[];for(let t=0;t<a.map.length;t+=1){const x=a.map[t],e=a.$gameTable.insertRow(),n=[];a.$cells.push(n);for(let o=0;o<x.length;o+=1){x[o];const l=e.insertCell();n.push(l),l.coln=o,l.rown=t,l.cellID=t*a.width+o,l.chest=a.chests[l.cellID],l.id=`${o}_${t}`}}}function W(){function t(){}function x(t){$(JSON.parse(t.data)),M(),k()}function e(t){t.wasClean,a.curWebSocket=null,a.wsConnectInterval=setInterval((()=>{a.curWebSocket=n()}),2e3)}function n(){let n;return n=window.location.host.startsWith("127.0.0.1")?new WebSocket("ws://"+window.location.host+"/game/ws"):new WebSocket("wss://"+window.location.host+"/game/ws"),n.onopen=t,n.onmessage=x,n.onclose=e,a.wsConnectInterval&&(clearInterval(a.wsConnectInterval),a.wsConnectInterval=null),n}a.curWebSocket=null,a.wsConnectInterval=null,a.wsConnectInterval=setInterval((()=>{a.curWebSocket=n()}),2e3),a.curWebSocket=n()}function H(){localStorage.setItem("x",document.body.scrollLeft),localStorage.setItem("y",document.body.scrollTop)}function j(){document.body.scrollLeft=+localStorage.getItem("x"),document.body.scrollTop=+localStorage.getItem("y")}function D(){a.$game=document.getElementById("game"),a.$header=document.getElementById("header"),a.$gameTable=document.getElementById("gameTable"),a.$modal=document.getElementById("modal-content"),a.$popup=document.getElementById("popup"),a.$popupText=document.getElementById("popupText"),a.$popupButton1=document.getElementById("popupButton1"),a.$popupButton2=document.getElementById("popupButton2"),a.$header=document.getElementById("header"),Object.assign(a,r(s)),O(),j(),document.body.addEventListener("scroll",H),M(),b(),W(),setInterval((()=>b()),6e4)}function N(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}window.addEventListener("load",D);