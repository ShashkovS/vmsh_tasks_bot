const CELL_SIZE_IN_REM=3,MODAL_WIDTH_IN_CELLS=5,MODAL_HEIGHT_IN_CELLS=3,FOG_OF_WAR=15,FOR_OPACITY_LEN=12,mapAsString="\nx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\nx\to\to\to\t1\t1\t2\t6\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\t1\t1\t1\t1\tx\t1\t1\t4\t1\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t5\t3\tx\t3\t5\t10\tx\nx\to\to\to\t1\t1\t2\tx\tx\tx\tx\tx\tx\tx\t4\tx\t4\t4\tx\t1\t3\t3\t1\tx\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t4\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t3\tx\t1\t3\t5\tx\nx\to\to\to\t1\t1\t2\tx\t1\t1\t1\tx\t4\tx\t8\tx\t1\t1\tx\t1\t1\t1\t1\t4\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t4\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t3\tx\t1\t1\t3\tx\nx\t1\t1\t1\t1\t1\t2\t3\t1\t4\t1\t4\t1\tx\tx\tx\t1\t1\tx\tx\tx\tx\tx\tx\t3\t3\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t3\tx\t1\t1\t1\tx\nx\t2\t2\t2\t2\t2\t2\tx\t4\tx\t1\t1\t1\t1\t1\t1\t1\t1\t4\t1\t1\t1\t1\t1\t1\t1\tx\t2\t1\t2\t1\t2\t1\t2\t1\tx\tx\tx\tx\t7\tx\tx\tx\tx\tx\tx\t3\tx\t6\tx\tx\tx\nx\t5\tx\tx\tx\t4\tx\tx\tx\tx\tx\t1\t1\t1\t1\t1\t1\t1\t4\t1\t1\t1\t1\t1\t1\t1\tx\t1\t2\t1\t2\t1\t2\t1\t2\t5\t1\t1\t1\t1\t1\t1\tx\t2\t2\tx\t1\t2\t1\t2\t1\tx\nx\t1\t1\t1\tx\t1\t1\t1\t2\t2\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t2\t1\t2\t1\t2\t1\t2\t1\tx\t1\t1\t1\t1\t1\t1\tx\t2\t2\tx\t2\t1\t2\t1\t2\tx\nx\t1\t3\t1\tx\t1\t1\t1\t2\t2\tx\t8\t6\t3\t1\t1\t1\t3\t1\t1\t1\t3\t1\t1\t1\t3\tx\t1\t2\t1\t2\t1\t2\t1\t2\tx\t1\t1\t1\t1\t1\t1\tx\t2\t2\tx\t1\t2\t1\t2\t1\tx\nx\t1\t3\t1\tx\t1\t1\t1\t2\t2\tx\t6\t3\t1\t3\t1\t3\t1\t3\t1\t3\t1\t3\t1\t3\t1\t4\t2\t1\t2\t1\t2\t1\t2\t1\tx\t1\t1\t1\t1\t1\t1\tx\t2\t2\tx\t2\t1\t2\t1\t2\tx\nx\t1\t1\t1\tx\t1\t1\t1\t2\t2\tx\t3\t1\t1\t1\t3\t1\t1\t1\t3\t1\t1\t1\t3\t1\t1\t4\t1\t2\t1\t2\t1\t2\t1\t2\tx\t1\t1\t1\t1\t1\t1\tx\t2\t2\tx\tx\tx\tx\tx\tx\tx\nx\tx\tx\tx\tx\t5\tx\tx\tx\tx\tx\tx\t6\t6\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\t1\t1\t1\t1\t1\tx\tx\t6\tx\t4\t4\t4\tx\t9\tx\nx\t1\t1\t1\tx\t1\tx\t2\t2\t2\t2\t2\t2\t2\tx\t3\t2\t3\tx\t1\t1\t1\t1\t5\t2\t5\t1\t1\t1\t1\tx\t3\t3\t3\t9\tx\t1\t1\t1\t1\t1\t1\t3\t3\t3\t3\t3\tx\t5\t5\t5\tx\nx\t1\t3\t1\tx\t1\tx\t2\t2\t2\t2\t2\t2\t2\tx\t2\t3\t2\tx\t1\t3\t3\t1\tx\t2\tx\t1\t3\t3\t1\tx\t5\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\nx\t1\t3\t1\tx\t1\tx\t6\t6\tx\tx\tx\tx\tx\tx\t3\t2\t3\tx\t1\t1\t1\t1\tx\t2\tx\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t6\t1\t1\tx\t1\t2\t1\t2\t1\t2\t1\t2\t1\tx\nx\t1\t1\t1\tx\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\tx\tx\tx\tx\tx\t6\tx\tx\tx\tx\tx\tx\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\tx\t2\t4\t5\t1\t2\t4\t5\t1\t2\tx\nx\t1\t3\t1\tx\t1\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t6\tx\t1\t1\t1\t1\t1\t1\t4\t2\t2\t4\t4\tx\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\tx\t1\t5\t4\t2\t1\t5\t4\t2\t1\tx\nx\t1\t3\t1\tx\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t2\t6\t1\t1\t1\t1\t1\t1\t4\t2\t2\t4\t8\tx\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\tx\t2\t4\t5\t1\t2\t4\t5\t1\t2\tx\nx\t1\t1\t1\t5\t1\t5\t1\t3\t1\t3\t1\t3\t1\t3\t1\tx\t6\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\t1\tx\t1\t5\t4\t2\t1\t5\t4\t2\t1\tx\nx\tx\tx\tx\tx\t6\tx\t1\t3\t1\t3\t1\t3\t1\t3\t1\tx\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t4\t1\t1\t1\t1\t1\t1\t1\tx\t2\t1\t2\t1\t2\t1\t2\t1\t2\tx\nx\t1\t1\t1\tx\t2\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t2\tx\t1\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\tx\tx\tx\tx\t7\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t4\t4\tx\nx\t1\t3\t1\tx\t2\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\tx\t1\tx\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\t1\tx\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\nx\t1\t3\t1\t6\t2\t6\t2\t1\t2\t1\t2\t1\t2\t1\t2\t1\t2\tx\t1\tx\t2\tx\tx\tx\tx\tx\tx\tx\tx\t2\tx\t1\tx\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\nx\t1\t1\t1\t6\t2\t6\t1\t2\t1\t2\t1\t2\t1\t2\t1\t2\t1\tx\t1\tx\t2\tx\t3\t3\t3\t3\t3\t3\t6\t2\tx\t1\tx\t2\t2\tx\t2\t2\tx\tx\tx\tx\tx\t2\tx\tx\tx\tx\tx\t2\tx\nx\tx\tx\tx\tx\t7\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\tx\t2\tx\t3\tx\tx\tx\tx\t3\tx\t2\tx\t1\tx\t2\tx\tx\t2\t2\t2\t2\t2\t2\tx\t2\tx\t2\t2\t2\tx\t2\tx\nx\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t1\tx\t2\tx\t3\tx\t9\t10\tx\t3\tx\t2\tx\t1\tx\t2\t2\tx\t2\t2\t2\t2\t2\tx\tx\t2\tx\t2\t2\t2\tx\t2\tx\nx\t1\t3\t1\tx\tx\tx\t4\tx\tx\tx\tx\tx\t1\t3\t1\t3\t1\tx\t1\tx\t2\tx\t3\t7\t8\t9\tx\t3\tx\t2\tx\t1\tx\t2\t2\tx\t2\t2\t2\t2\tx\tx\t2\t2\tx\tx\tx\tx\tx\t2\tx\nx\t1\t3\t1\t5\t1\t1\t1\t1\t1\t1\t1\tx\t1\t3\t1\t3\t1\tx\t1\tx\t2\tx\t3\tx\tx\tx\tx\t3\tx\t2\tx\t1\tx\t2\t2\tx\t2\t2\t2\tx\tx\t2\t2\t2\t2\t2\t2\tx\tx\t2\tx\nx\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\tx\t2\tx\t3\t3\t3\t3\t3\t3\tx\t2\tx\t1\tx\t2\t2\tx\t2\t2\t2\tx\t2\t2\t2\t2\t2\t2\tx\tx\t2\t2\tx\nx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t5\tx\tx\tx\t1\tx\t2\tx\tx\tx\tx\tx\tx\tx\tx\t2\tx\t1\tx\t2\t2\tx\t2\t2\t2\tx\t2\t2\t2\t2\t2\tx\tx\t2\t2\t2\tx\nx\t1\t1\tx\t1\t1\t1\t4\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\tx\t1\t5\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\t1\tx\t2\tx\tx\tx\t2\t2\tx\t2\t2\t2\t2\tx\tx\t2\t2\t2\t2\tx\nx\t1\t1\tx\t1\t3\t1\tx\t1\t3\t1\tx\t1\t1\t1\t1\t1\t1\tx\t1\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\tx\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\nx\t1\t1\tx\t1\t3\t1\tx\t1\t3\t1\tx\t3\t3\t3\t3\t3\t3\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\nx\t1\t1\t3\t1\t1\t1\tx\t1\t1\t1\t5\t1\t1\t1\t1\t1\t1\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t7\tx\tx\tx\tx\tx\tx\nx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\t1\t1\t1\t1\t1\tx\t8\tx\t1\t1\tx\t1\t1\tx\t1\t1\tx\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t2\t3\t4\t5\t5\t5\t4\t3\t2\t1\tx\nx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t3\t3\t3\t3\t3\t3\tx\t4\tx\t1\t1\tx\t1\t1\tx\t1\t1\tx\t1\t3\t1\tx\t1\t3\t3\t3\t1\tx\t1\t2\t3\t4\t4\t4\t4\t4\t3\t2\t1\tx\nx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t2\tx\t1\t1\tx\t1\t1\tx\t1\t1\tx\t1\t3\t1\tx\t1\t3\t9\t3\t1\tx\t1\t2\t3\t3\t3\t3\t3\t3\t3\t2\t1\tx\nx\t5\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t4\tx\tx\tx\tx\t1\t1\tx\t1\t1\tx\t1\t1\tx\t1\t1\t1\tx\t1\t3\t3\t3\t1\tx\t1\t2\t2\t2\t2\t2\t2\t2\t2\t2\t1\tx\nx\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\t1\t1\t1\t1\t1\t1\t1\t1\tx\tx\t4\tx\tx\t4\tx\tx\t4\tx\t1\t3\t1\tx\t1\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tx\nx\t2\t2\t2\t2\t2\t2\t2\t2\t2\t2\tx\t1\t1\t1\t1\t1\t1\t1\t1\t5\t1\t1\t5\t2\t2\t2\t2\t2\tx\t1\t3\t1\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t7\tx\nx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t6\tx\tx\tx\tx\tx\tx\tx\tx\t5\tx\tx\t5\tx\tx\tx\tx\tx\tx\tx\t1\t1\t1\t5\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t2\tx\nx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t6\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\tx\tx\tx\tx\tx\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t2\tx\tx\nx\t1\t3\t1\t3\t1\t3\t1\t3\t1\t3\t1\tx\tx\tx\tx\tx\tx\t1\t1\tx\t1\t3\t1\t3\t1\t3\t1\tx\t9\t3\t3\t3\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t2\tx\tx\tx\nx\t1\t3\t1\t3\t1\t3\t1\t3\t1\t3\t1\t1\t1\t1\t3\t3\tx\t1\t1\tx\t1\t3\t1\t3\t1\t3\t1\tx\tx\tx\tx\t6\tx\t4\tx\tx\tx\tx\tx\t1\t1\t1\t1\t1\t1\t1\t2\tx\tx\t8\tx\nx\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t3\t3\tx\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t1\t5\t1\t1\t1\tx\t2\t2\t2\t2\t2\tx\t1\t1\t1\t1\t1\t1\t2\tx\tx\t1\t1\tx\nx\tx\tx\tx\tx\t6\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t6\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\t1\t3\t1\tx\t2\t2\t2\t2\t2\tx\t1\t1\t1\t1\t1\t2\t7\tx\t1\t1\t1\tx\nx\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t5\t1\t1\t1\tx\t1\tx\t1\t1\t1\tx\t1\t1\t1\t1\t1\t1\t1\t5\t1\t3\t1\tx\tx\tx\tx\tx\t4\tx\t1\t1\t1\t1\t2\t7\t7\to\t1\t1\t3\tx\nx\t1\t1\t1\t1\t1\t1\tx\t1\t3\t1\tx\t1\t1\t1\tx\t1\tx\t1\tx\t1\tx\t1\t3\t3\t1\t3\t3\t1\tx\t1\t1\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t1\t2\tx\tx\to\to\t1\t3\t5\tx\nx\t3\t1\t1\t1\t1\t1\tx\t3\t5\t3\tx\t1\t1\t2\tx\t1\tx\t1\tx\t1\tx\t1\t1\t1\t1\t1\t1\t1\tx\t1\t3\t1\tx\t1\t1\t1\t1\t1\tx\t1\t1\t2\tx\tx\t1\t1\t1\t3\t5\t6\tx\nx\t5\t3\t1\t1\t1\t1\tx\t1\t3\t1\tx\t1\t2\t4\tx\t1\tx\t1\tx\t1\tx\t1\t3\t3\t1\t3\t3\t1\tx\t1\t3\t1\tx\t1\t1\t1\t1\t1\tx\t1\t2\tx\tx\t1\t1\t1\t3\t5\t6\t7\tx\nx\t10\t5\t3\t1\t1\t1\t5\t1\t1\t1\tx\t2\t4\t8\tx\t1\t1\t1\tx\t1\t4\t1\t1\t1\t1\t1\t1\t1\tx\t1\t1\t1\t5\t1\t1\t1\t1\t1\t5\t2\tx\tx\t8\t1\t1\t3\t5\t6\t7\t10\tx\nx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\tx\n",scene={$game:void 0,$header:void 0,$gameTable:void 0,$modal:void 0,$popup:void 0,$popupText:void 0,$popupButton1:void 0,$popupButton2:void 0,map:void 0,width:void 0,height:void 0,opened:[],scores:{},flags:{},myFlag:void 0};function showPopup(t,x,e,n,o,s,c,l,a){const p=parseFloat(getComputedStyle(document.documentElement).fontSize),i=15*p/2,d=9*p/2;let r=x-d-3*p/2;r<d&&(r=x+d+3*p/2),scene.$modal.style.top=`${r}px`,scene.$modal.style.left=`${Math.min(Math.max(t,i),window.scrollX+window.innerWidth-i)}px`,scene.$popupText.innerHTML=e,scene.$popupButton1.innerText=n,scene.$popupButton1.title=o,scene.$popupButton1.onclick=s,scene.$popupButton1.focus(),void 0===c?scene.$popupButton2.style.display="none":(scene.$popupButton2.style.display="inline-block",scene.$popupButton2.innerText=c,scene.$popupButton2.onclick=a,scene.$popupButton2.title=l),scene.$popup.style.display="block"}function hidePopup(){document.getElementById("popup").style.display="none"}function convertMap(t){const x=t.trim().split("\n").map((t=>t.trim().split("\t").map((t=>parseInt(t)||t))));return{map:x,width:x[0].length,height:x.length}}async function postData(t="",x={}){return(await fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(x)})).json()}function postBuy(t,x){postData("/game/buy",{x:t.coln,y:t.rown,amount:x}).then((x=>{t.className="so",scene.opened.push(t.cellID),updateMap(),renderHeader()}))}function postFlag(t){postData("/game/flag",{x:t.coln,y:t.rown}).then((t=>{}))}function refreshData(t){scene.opened.push(...t.opened.map((([t,x])=>x*scene.width+t))),scene.scores={};for(const x of t.events)x>0?scene.scores[x]=1+(0|scene.scores[x]):buy(-x);scene.flags={},t.flags.forEach((([t,x])=>{const e=x*scene.width+t;scene.flags[e]=1+(0|scene.flags[e])})),scene.myFlag=t.myFlag&&2===t.myFlag.length&&t.myFlag.y*scene.width+t.myFlag.x}function fetchInitialData(){scene.$header.innerHTML="<div><p><span>...⚡</span> — загружаем информацию...</p></div>",postData("/game/me",{}).then((t=>{refreshData(t),updateMap(),renderHeader()}))}function yesClicked(t,x){t.textContent="...",t.onclick=null,buy(x),renderHeader(),hidePopup(),postBuy(t,x)}function flagYesClicked(t){scene.myFlag&&(scene.flags[scene.myFlag]=Math.max(0,(0|scene.flags[scene.myFlag])-1)),scene.myFlag=t.cellID,scene.flags[scene.myFlag]=1+(0|scene.flags[scene.myFlag]),updateMap(),hidePopup(),postFlag(t)}function noClicked(t){t.classList.remove("selected"),hidePopup()}function okClicked(t){t.classList.remove("selected"),hidePopup()}function onCellClick(t){const x=t.target,e=x.offsetLeft+x.offsetWidth/2-document.body.scrollLeft,n=x.offsetTop+x.offsetHeight/2-document.body.scrollTop,{rown:o,coln:s}=x,c=o-1>=0&&"o"===scene.$cells[o-1][s].textContent,l=o+1<scene.height&&"o"===scene.$cells[o+1][s].textContent,a=s-1>=0&&"o"===scene.$cells[o][s-1].textContent,p=s+1<scene.width&&"o"===scene.$cells[o][s+1].textContent;if(c||l||a||p){x.classList.add("selected");const t=+x.textContent;void 0===tryToBuy(t)?showPopup(e,n,"Не хватает ⚡<br>Решите задачку!","Буду решать!","Закрыть окно",(()=>okClicked(x))):showPopup(e,n,`Изучить клетку<br>за ${x.textContent}⚡?`,"✅ Да!","Да, изучить клетку!",(()=>yesClicked(x,t)),"❌ Нет","Нет, вернуться назад",(()=>noClicked(x)))}else x.classList.add("selected"),showPopup(e,n,"Поставить флаг <br>для всех в ячейку?","🚩 Да!","Да, поставить флаг!",(()=>flagYesClicked(x)),"Нет","Нет, вернуться назад",(()=>noClicked(x)))}function renderHeader(){scene.$header.innerHTML=Object.entries(scene.scores).map((([t,x])=>x>0?`<div><p><span>${t}⚡</span> × ${x} </p></div>`:"")).join(""),0===scene.$header.innerHTML.length&&(scene.$header.innerHTML="<div><p><span>0⚡</span> — чтобы получить энергию, нужно решить задачу </p></div>")}function tryToBuy(t){for(const[x,e]of Object.entries(scene.scores))if(e>0&&x>=t)return x}function buy(t){for(const[x,e]of Object.entries(scene.scores))if(e>0&&x>=t){scene.scores[x]-=1;const e=x-t;return e>0&&(scene.scores[e]=1+(0|scene.scores[e])),!0}return!1}function updateMap(){for(const t of scene.opened){const x=Math.trunc(t/scene.width),e=t%scene.width;"x"!==scene.map[x][e]&&(scene.map[x][e]="o")}const t=new Map;let x=new Set;for(let e=0;e<scene.map.length;e+=1)for(let n=0;n<scene.map[0].length;n+=1)if("o"===scene.map[e][n]){const o=e*scene.width+n;t.set(o,0),x.add(o)}let e=0;for(;x.size>0&&e<15;){let n=new Set;for(const e of x){const x=Math.trunc(e/scene.width),o=e%scene.width;if("x"!==scene.map[x][o]&&0!==x&&0!==o&&o!==scene.width-1&&x!==scene.height-1)for(const x of[-1,1,-scene.width-1,-scene.width,1-scene.width,+scene.width-1,+scene.width,+scene.width+1]){const o=e+x;void 0===t.get(o)&&(t.set(o,t.get(e)+1),n.add(o))}}x=n,e+=1}for(let x=0;x<scene.map.length;x+=1){const e=scene.map[x];for(let n=0;n<e.length;n+=1){const o=e[n],s=scene.$cells[x][n],c=t.get(s.cellID),l=0===x||0===n||n===scene.width-1||x===scene.height-1;c<15||l?(s.textContent=o,s.className=`s${o}`,s.onclick=s.ondblclick=+o?onCellClick:null,s.style.opacity=!l&&15-c<=12?(15-c)/12:1):(s.textContent="",s.className="fog",s.onclick=s.ondblclick=null);const a=[];for(let t=0;t<(0|scene.flags[s.cellID]);t++){const x=(.71*t%1.5).toFixed(2),e=(-.6-.61*t%1.8).toFixed(2);a.push(`<div class="flag" style="top: ${e}rem; left: ${x}rem; "></div>`)}s.innerHTML=s.textContent+a.join("")}}renderHeader()}function initialMapRender(){scene.$cells=[];for(let t=0;t<scene.map.length;t+=1){const x=scene.map[t],e=scene.$gameTable.insertRow(),n=[];scene.$cells.push(n);for(let o=0;o<x.length;o+=1){x[o];const s=e.insertCell();n.push(s),s.coln=o,s.rown=t,s.cellID=t*scene.width+o}}}function prepareWebsockets(){function t(t){}function x(t){refreshData(JSON.parse(t.data)),updateMap(),renderHeader()}function e(t){t.wasClean,scene.curWebSocket=null,scene.wsConnectInterval=setInterval((()=>{scene.curWebSocket=n()}),2e3)}function n(){let n;return n=window.location.host.startsWith("127.0.0.1")?new WebSocket("ws://"+window.location.host+"/game/ws"):new WebSocket("wss://"+window.location.host+"/game/ws"),n.onopen=t,n.onmessage=x,n.onclose=e,scene.wsConnectInterval&&(clearInterval(scene.wsConnectInterval),scene.wsConnectInterval=null),n}scene.curWebSocket=null,scene.wsConnectInterval=null,scene.wsConnectInterval=setInterval((()=>{scene.curWebSocket=n()}),2e3),scene.curWebSocket=n()}function init(){scene.$game=document.getElementById("game"),scene.$header=document.getElementById("header"),scene.$gameTable=document.getElementById("gameTable"),scene.$modal=document.getElementById("modal-content"),scene.$popup=document.getElementById("popup"),scene.$popupText=document.getElementById("popupText"),scene.$popupButton1=document.getElementById("popupButton1"),scene.$popupButton2=document.getElementById("popupButton2"),scene.$header=document.getElementById("header"),Object.assign(scene,convertMap(mapAsString)),initialMapRender(),updateMap(),fetchInitialData(),prepareWebsockets(),setInterval((()=>fetchInitialData()),6e4)}function toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}